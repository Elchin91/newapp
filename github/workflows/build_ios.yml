name: üçé Build iOS App

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    name: Build iOS App
    runs-on: macos-latest
    
    steps:
    - name: üì• Checkout code
      uses: actions/checkout@v4
      
    - name: üîß Setup Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: latest-stable
        
    - name: üì± Build iOS App
      run: |
        cd iOS_App
        
        # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è —Å–±–æ—Ä–∫–∏
        mkdir -p ../build
        
        # –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–±–æ—Ä–∫–∏
        xcodebuild clean -project iSponsorBlockTV.xcodeproj -scheme iSponsorBlockTV
        
        # –°–æ–±–∏—Ä–∞–µ–º –∞—Ä—Ö–∏–≤
        xcodebuild archive \
          -project iSponsorBlockTV.xcodeproj \
          -scheme iSponsorBlockTV \
          -destination generic/platform=iOS \
          -archivePath ../build/iSponsorBlockTV.xcarchive \
          CODE_SIGN_IDENTITY="" \
          CODE_SIGNING_REQUIRED=NO \
          CODE_SIGNING_ALLOWED=NO
        
        # –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º IPA
        xcodebuild -exportArchive \
          -archivePath ../build/iSponsorBlockTV.xcarchive \
          -exportPath ../build \
          -exportOptionsPlist export_options.plist
          
    - name: üì¶ Upload IPA Artifact
      uses: actions/upload-artifact@v4
      with:
        name: iSponsorBlockTV-IPA
        path: build/iSponsorBlockTV.ipa
        retention-days: 30
        
    - name: üè∑Ô∏è Create Release (on tag)
      if: startsWith(github.ref, 'refs/tags/')
      uses: softprops/action-gh-release@v1
      with:
        files: build/iSponsorBlockTV.ipa
        name: iSponsorBlockTV ${{ github.ref_name }}
        body: |
          üì± iSponsorBlockTV –¥–ª—è iOS
          
          üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ TrollStore:
          1. –°–∫–∞—á–∞–π—Ç–µ iSponsorBlockTV.ipa
          2. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –∏ –≤—ã–±–µ—Ä–∏—Ç–µ TrollStore
          3. –ù–∞–∂–º–∏—Ç–µ Install
          
          ‚ú® –ù–æ–≤–æ–µ –≤ —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏:
          - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫
          - –£–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
